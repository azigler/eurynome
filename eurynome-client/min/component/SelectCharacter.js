"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,r,a){return r&&_defineProperties(e.prototype,r),a&&_defineProperties(e,a),e}var m=require("mithril"),GridCard=require("./GridCard"),ButtonBack=require("./ButtonBack"),_require=require("construct-ui"),Button=_require.Button;module.exports=function(){function e(){var r=this;_classCallCheck(this,e),this.id="SelectCharacter",this.newCharacterCardHtml="",this.world=m.route.param("world"),window.io.emit("check-can-make-new-character",{world:this.world}),window.io.on("can-make-new-character",function(e){r.newCharacterCardHtml=e?m(GridCard,{class:"new-char"},r.newCharacterCard(r.world)):"",m.redraw()})}return _createClass(e,[{key:"onremove",value:function(){window.io.off("can-make-new-character")}},{key:"view",value:function(){var e=this,r=window.$eu.stream.availableCharacters().filter(function(r){return r.world===e.world})||[],a=window.$eu.stream.availableWorlds(),t=window.$eu.sfx.get("button");return m("div",{id:this.id,class:"eu-select"},m("h3",null,"select a character"),m(GridCard,null,r.map(function(r,a){return m("a",{href:"#!/world?world=".concat(e.world,"&char=").concat(r.name),key:a,onclick:function(){window.io.emit("play-as-character",{name:r.name,world:e.world}),t.play()}},m("span",{class:"option"},r.name))})),this.newCharacterCardHtml,m(ButtonBack,{route:this.handleBack(a)}))}},{key:"handleBack",value:function(e){return 1===e.length?"/splash":"/select-world"}},{key:"newCharacterCard",value:function(e){var r=window.$eu.sfx.get("button");return m("a",{href:"#!/create-character?world=".concat(e),key:"new-char",onclick:function(){r.play()}},m("span",{class:"option new-char"},"+ new character"))}}]),e}();